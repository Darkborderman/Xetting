# 後端

## 伺服器是怎麼運作的?

伺服器，簡單的說就是瀏覽器發送一個http request到伺服器上，伺服器可以接受request並進行解析，並回傳respond回到瀏覽器上。

而我們專案選用的express.js的運作架構是以MVC模型(Model–view–controller Model)運行的

### 什麼是MVC模型?

(Wiki或餵Google有更完整的解釋，這裡只做簡單的說明)

以我們做的網頁為例，我們可以將整體分成三個部分

- 程式(Model):(主要是志忠負責)負責爬蟲的部分，寫程式將我們想要爬的網站的資料抓取下來，然後回傳到後端處理

- 前端(View):(主要是大瑋負責)負責網頁的呈現與處理後端丟過來的資料

- 後端(Controller):(主要是良杰負責，大瑋幫了我很多QQ)處理http request(由前端發送過來)，並根據request做routing之後對應到不同的function上，呼叫程式寫好的各種api並將資料回傳給前端作呈現

不得不說大瑋對這方面真的很熟悉，很多東西都是大瑋教我們的，感恩大瑋讚嘆大瑋。

### Routing是什麼?

直接舉實例來看吧，平常我們拜訪某個網頁的時候，大概會是從一個訪問像是http://localhost:3000/ 的URL，

而瀏覽器就會開始對localhost(這邊只是舉例)這個網域的port 3000發送一個http的request，而且指定的路徑是"/"(通常是index)

(至於https，基本上還需要驗證之後才能用https的協定，所以我們的網頁是http的協定。要申請網域之後才能做驗證=_=)

(而且基本上這樣做還會有一些問題，別人沒辦法用我們的網站，因為有一些東西不能透過http進行處理，因為安全性的問題，比如降級攻擊之類的)

而當伺服器接受到"/" 的request之後，就要執行相對應的處理，並回傳respond。

如果把URL改成http://localhost:3000/result，就會將路徑指定到"/result"上，

所以伺服器就要處理"/result" 的請求，一樣會對應到一個專門處理他的函式並回傳。

基本上處理這些路徑就是所謂的routing，而在使用express.js作為伺服器的基礎下，我們將路由器(router)直接寫在app裡面，這樣開發上其實就方便許多，

不然還要分成server, router, requestHandler, app等等這些東西實在太麻煩了。

### GET/POST參數

在前端發送request的同時，可能還會多加一些參數，參數發送的方式有分兩種:GET和POST，

基本上我們寫得只有用到GET這種，最主要的差別就是POST會將參數隱藏起來這樣。

而此時我們的URL大概會長這個樣子http://localhost:3000/result?query=neko

表示我在發送請求的同時，還帶了一個叫做query的參數，而他的值是neko，

在後端接受到這種參數的時候就可以做更多的處理了，

我們的後端(app.js)將這個參數丟到志忠寫的API當中，然後他會回傳一串爬蟲的結果回來到app上，然後再將這些結果回傳到前端(pug)呈現

當然參數可能不只一個，以我們的網頁來說，我們還有source、page的參數可以使用。

### JavaScript也可以寫的很物件導向

> 物件導向只是一種態度  By 慣C Jserv

在node.js裡面，我們可以利用`module.exports` 將我們寫好的這些function丟給其他的檔案使用，

在其他檔案利用`<變數名稱> = require('<exports出來的東西>')`，然後就可以直接`<變數名稱>.(內部的function)` 直接拿來使用，

變成說，我們可以把東西切割成一個個模組，例如志忠寫的爬蟲的東西就分成N網的、D網的、還有E網的整合到一個controller上，

然後我的app直接require那個controller，拿內部的function進行使用，這樣的做法跟概念就和物件導向沒什麼不一樣，

在開發上面的難度也因此而降低不少。

----

## 開發過程遇到的困難

首先就是"架構"，這個東西其實討論了蠻久的，整個流程是怎麼運作的，會有那些東西，它們之間是怎麼溝通的，在這一部份我覺得是最困難也最不好起手的東西，

但一旦這些東西都定出來了，有個基本的模型之後，要加東西進去就很快了，這邊還是一樣要感恩大瑋讚嘆大瑋，沒有他的話大概我們的專題就不會做的那麼有系統了。

然後就是處理request的部分，其實一個http request丟的東西很多，雖然要找到可以用的東西不難，但是一開始還真的不能理解到底要怎麼處理這玩意兒，

基本上前端要有一個對應的東西，可能是表單(`<form></form>`)之類的互動式元件，他會有個action和method對應到一個路徑和參數的傳遞方式，

而底下可能會有像是`<input>`的元素，會有一個name，在傳送request的時候，

我們就可以從action對應的路徑得到的request的query的東西(name的數值，例如name=source的話，那就是request.query.source這樣)

如此一來就可以抓取這個值然後進行處理之後丟給API 這樣，

然後還有就是有哪些參數要丟真的要溝通好，要有一個統一的名字，一開始還不知道怎麼丟result給前端的時候浪費了很多時間在這上面，

但是確定要丟那些東西之後就真的分工分的很明確，API回傳這些東西回來，然後我回傳這些東西給前端，完美(???

再來可能就只是一些BUG的部分，但修一修之後很快就都弄好了，

---

最大的問題還是在於志忠負責的API那邊，他真的蠻辛苦的，因為每個網站儲存東西的方式都不一樣，

最好做的還是N網的東西，而其他的網站都不太好弄，例如E網會對圖片進行處理，讓他分散在不同地方上，很難去做爬蟲

D網會對Cross Origin Request 進行block，所以圖片都沒辦法正常顯示出來QQ

最後志忠做了蠻多東西的，但是到目前還是只有N網的能完善的處理。感恩志忠，讚嘆志忠QQ

大瑋的話也是在各方面都幫了大忙，不管是前端後端還是程式的東西都有弄了很多東西，感覺得出來他對於網頁這一塊蠻有熱情的，雖然一直幹譙它就是了

其實寫這些大概還是因為其他組員不太會寫這種心路歷程之類的，所以如果助教有看到的話也請幫他們多加點分數好嗎?

----

## 相關資料

https://www.nodebeginner.org/index-zh-tw.html

https://expressjs.com/zh-tw/

大概就先寫這些東西吧，以後想到可能會再加

更新:有些東西會被當作語法顯示，這篇是基於原始碼檔案進行編輯的，如果有奇怪的地方請看原始檔案，造成不便請見諒@@
